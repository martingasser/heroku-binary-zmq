#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e
set -o pipefail

BUILD_DIR=${1%/}
CACHE_DIR=${2%/}
ENV_DIR=${3%/}
ZMQ_VENDOR_URL="$(cat $BUILD_DIR/zmq-vendor-url)"

indent() {
		sed -u 's/^/        /'
}

pecho() {
		echo "-----> $1"
}

npecho() {
		echo "       $1"
}

npecho $ENV_DIR

echo "$PKG_CONFIG_PATH:$BUILD_DIR/lib/pkgconfig">$ENV_DIR/PKG_CONFIG_PATH
echo "-L$BUILD_DIR/lib" >$ENV_DIR/LDFLAGS
echo "-L$BUILD_DIR/include" >$ENV_DIR/CPPFLAGS

VENDOR_DIR=$BUILD_DIR/vendor

mkdir $VENDOR_DIR
cd $VENDOR_DIR

npecho "fetching binary from $ZMQ_VENDOR_URL"
curl -s $ZMQ_VENDOR_URL | tar zxf -

npecho "zeromq  unpacked in $VENDOR_DIR"

npecho "setting zeromq compile flags"

