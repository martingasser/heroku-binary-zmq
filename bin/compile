#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e
set -o pipefail

BUILD_DIR=${1%/}
CACHE_DIR=${2%/}
ZMQ_VENDOR_URL="$(cat $BUILD_DIR/zmq-vendor-url)"

indent() {
		sed -u 's/^/        /'
}

pecho() {
		echo "-----> $1"
}

npecho() {
		echo "       $1"
}

cd $BUILD_DIR

npecho "fetching binary from $ZMQ_VENDOR_URL"
curl -s $ZMQ_VENDOR_URL | tar zxf -

npecho "zeromq  unpacked in $BUILD_DIR"

ls "$BUILD_DIR/lib"

npecho "setting zeromq compile flags"

export LDFLAGS=-L$BUILD_DIR/lib
export CPPFLAGS=-I$BUILD_DIR/include
export PKG_CONFIG_PATH="$PKG_CONFIG_PATH:$BUILD_DIR/lib/pkgconfig/"
npecho "Testing: $(ls $PKG_CONFIG_PATH)"